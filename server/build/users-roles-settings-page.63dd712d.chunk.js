(self.webpackChunkserver=self.webpackChunkserver||[]).push([[6719],{23005:(C,E,s)=>{"use strict";s.r(E),s.d(E,{default:()=>bs});var e=s(92132),r=s(21272),n=s(39747),d=s(17703),u=s(69224),p=s(55794),g=s(43121),v=s(69564),M=s(32559),m=s(43242),h=s(57842),A=s(57564),N=s(68065),G=s(81926),I=s(168),L=s(13333),$=s(61535),U=s(54894),D=s(74930),W=s(33544),T=s.n(W);const te=(0,r.createContext)({}),ne=({children:t,value:o})=>(0,e.jsx)(te.Provider,{value:o,children:t}),q=()=>(0,r.useContext)(te);ne.propTypes={children:T().node.isRequired,value:T().object.isRequired};var J=s(34075),Ae=s(47098),Ce=s(96294),Re=s(80725),Me=s(39404),be=s.n(Me);function Te(t){switch(t){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return be()(t.replace("api::","").replace("plugin::",""))}}const Pe=Te,Ee=(t,o)=>{const i=Object.keys(o).sort().map(a=>({name:a,isOpen:!1}));return{...t,collapses:i}};var F=s(44370),Se=s(45635),oe=s.n(Se),re=s(12050),ie=s(96586),Le=s(28816),De=s(2600),Z=s.n(De),K=s(63891);const ae=(0,K.AH)`
  background: ${t=>t.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Oe=(0,K.Ay)(F.a)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${t=>t.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${t=>t.isActive&&ae}
  &:hover {
    ${ae}
  }
`,Be=K.Ay.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,le=({subCategory:t})=>{const{formatMessage:o}=(0,U.A)(),{onChange:i,onChangeSelectAll:a,onSelectedAction:f,selectedAction:l,modifiedData:x}=q(),y=(0,r.useMemo)(()=>Z()(x,t.name,{}),[x,t]),j=(0,r.useMemo)(()=>Object.values(y).every(c=>c.enabled===!0),[y]),R=(0,r.useMemo)(()=>Object.values(y).some(c=>c.enabled===!0)&&!j,[y,j]),b=(0,r.useCallback)(({target:{name:c}})=>{a({target:{name:c,value:!j}})},[j,a]),P=(0,r.useCallback)(c=>l===c,[l]);return(0,e.jsxs)(F.a,{children:[(0,e.jsxs)(m.s,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsx)(F.a,{paddingRight:4,children:(0,e.jsx)(h.o,{variant:"sigma",textColor:"neutral600",children:t.label})}),(0,e.jsx)(Be,{}),(0,e.jsx)(F.a,{paddingLeft:4,children:(0,e.jsx)(re.S,{name:t.name,value:j,onValueChange:c=>b({target:{name:t.name,value:c}}),indeterminate:R,children:o({id:"app.utils.select-all",defaultMessage:"Select all"})})})]}),(0,e.jsx)(m.s,{paddingTop:6,paddingBottom:6,children:(0,e.jsx)(A.x,{gap:2,style:{flex:1},children:t.actions.map(c=>{const S=`${c.name}.enabled`;return(0,e.jsx)(N.E,{col:6,children:(0,e.jsxs)(Oe,{isActive:P(c.name),padding:2,hasRadius:!0,children:[(0,e.jsx)(re.S,{value:Z()(x,S,!1),name:S,onValueChange:B=>i({target:{name:S,value:B}}),children:c.label}),(0,e.jsxs)("button",{type:"button",onClick:()=>f(c.name),style:{display:"inline-flex",alignItems:"center"},children:[(0,e.jsx)(ie.s,{as:"span",children:o({id:"app.utils.show-bound-route",defaultMessage:"Show bound route for {route}"},{route:c.name})}),(0,e.jsx)(Le.A,{})]})]})},c.name)})})})]})};le.propTypes={subCategory:T().object.isRequired};const Ne=le,de=({name:t,permissions:o})=>{const i=(0,r.useMemo)(()=>oe()(Object.values(o.controllers).reduce((a,f,l)=>{const x=`${t}.controllers.${Object.keys(o.controllers)[l]}`,y=oe()(Object.keys(f).reduce((j,R)=>[...j,{...f[R],label:R,name:`${x}.${R}`}],[]),"label");return[...a,{actions:y,label:Object.keys(o.controllers)[l],name:x}]},[]),"label"),[t,o]);return(0,e.jsx)(F.a,{padding:6,children:i.map(a=>(0,e.jsx)(Ne,{subCategory:a},a.name))})};de.propTypes={name:T().string.isRequired,permissions:T().object.isRequired};const $e=de;var ce=s(88761);const Ue={collapses:[]},Ge=(t,o)=>(0,ce.Ay)(t,i=>{switch(o.type){case"TOGGLE_COLLAPSE":{i.collapses=t.collapses.map((a,f)=>f===o.index?{...a,isOpen:!a.isOpen}:{...a,isOpen:!1});break}default:return i}}),Ie=()=>{const{modifiedData:t}=q(),{formatMessage:o}=(0,U.A)(),[{collapses:i},a]=(0,r.useReducer)(Ge,Ue,l=>Ee(l,t)),f=l=>a({type:"TOGGLE_COLLAPSE",index:l});return(0,e.jsx)(m.s,{direction:"column",alignItems:"stretch",gap:1,children:i.map((l,x)=>(0,e.jsxs)(Ae.n,{expanded:l.isOpen,onToggle:()=>f(x),variant:x%2===0?"secondary":void 0,children:[(0,e.jsx)(Ce.P,{title:Pe(l.name),description:o({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:l.name}),variant:x%2?"primary":"secondary"}),(0,e.jsx)(Re.u,{children:(0,e.jsx)($e,{permissions:t[l.name],name:l.name})})]},l.name))})};var We=s(77965),Ve=s.n(We),Fe=s(28604),He=s.n(Fe),ze=s(34542),Je=s.n(ze),Qe=s(61468),Ye=s.n(Qe);const Ke=t=>{switch(t){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Xe=(0,K.Ay)(F.a)`
  margin: -1px;
  border-radius: ${({theme:t})=>t.spaces[1]} 0 0 ${({theme:t})=>t.spaces[1]};
`;function _({route:t}){const{formatMessage:o}=(0,U.A)(),{method:i,handler:a,path:f}=t,l=f?Ye()(f.split("/")):[],[x="",y=""]=a?a.split("."):[],j=Ke(t.method);return(0,e.jsxs)(m.s,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsxs)(h.o,{variant:"delta",as:"h3",children:[o({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",(0,e.jsx)("span",{children:x}),(0,e.jsxs)(h.o,{variant:"delta",textColor:"primary600",children:[".",y]})]}),(0,e.jsxs)(m.s,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0,children:[(0,e.jsx)(Xe,{background:j.background,borderColor:j.border,padding:2,children:(0,e.jsx)(h.o,{fontWeight:"bold",textColor:j.text,children:i})}),(0,e.jsx)(F.a,{paddingLeft:2,paddingRight:2,children:Je()(l,R=>(0,e.jsxs)(h.o,{textColor:R.includes(":")?"neutral600":"neutral900",children:["/",R]},R))})]})]})}_.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},_.propTypes={route:T().shape({handler:T().string,method:T().string,path:T().string})};const Ze=_,ke=()=>{const{formatMessage:t}=(0,U.A)(),{selectedAction:o,routes:i}=q(),a=He()(o.split("."),"controllers"),f=Z()(i,a[0]),l=a.slice(1).join("."),x=Ve()(f)?[]:f.filter(y=>y.handler.endsWith(l));return(0,e.jsx)(N.E,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"},children:o?(0,e.jsx)(m.s,{direction:"column",alignItems:"stretch",gap:2,children:x.map((y,j)=>(0,e.jsx)(Ze,{route:y},j))}):(0,e.jsxs)(m.s,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsx)(h.o,{variant:"delta",as:"h3",children:t({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})}),(0,e.jsx)(h.o,{as:"p",textColor:"neutral600",children:t({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"})})]})})},we=(t,o,i)=>({...t,initialData:o,modifiedData:o,routes:i});var qe=s(48940),ue=s.n(qe),_e=s(501),es=s.n(_e);const ss={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},ts=(t,o)=>(0,ce.Ay)(t,i=>{switch(o.type){case"ON_CHANGE":{const a=o.keys.length,f=o.keys[a-1]==="enabled";if(o.value&&f){const l=es()(o.keys,a-1).join(".");i.selectedAction=l}ue()(i,["modifiedData",...o.keys],o.value);break}case"ON_CHANGE_SELECT_ALL":{const a=["modifiedData",...o.keys],f=Z()(t,a,{}),l=Object.keys(f).reduce((x,y)=>(x[y]={...f[y],enabled:o.value},x),{});ue()(i,a,l);break}case"ON_RESET":{i.modifiedData=t.initialData;break}case"ON_SUBMIT_SUCCEEDED":{i.initialData=t.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:a}=o;i.selectedAction=a===t.selectedAction?"":a;break}default:return i}}),ge=(0,r.forwardRef)(({permissions:t,routes:o},i)=>{const{formatMessage:a}=(0,U.A)(),[f,l]=(0,r.useReducer)(ts,ss,b=>we(b,t,o));(0,r.useImperativeHandle)(i,()=>({getPermissions(){return{permissions:f.modifiedData}},resetForm(){l({type:"ON_RESET"})},setFormAfterSubmit(){l({type:"ON_SUBMIT_SUCCEEDED"})}}));const R={...f,onChange:({target:{name:b,value:P}})=>l({type:"ON_CHANGE",keys:b.split("."),value:P==="empty__string_value"?"":P}),onChangeSelectAll:({target:{name:b,value:P}})=>l({type:"ON_CHANGE_SELECT_ALL",keys:b.split("."),value:P}),onSelectedAction:b=>l({type:"SELECT_ACTION",actionToSelect:b})};return(0,e.jsx)(ne,{value:R,children:(0,e.jsxs)(A.x,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0",children:[(0,e.jsx)(N.E,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(m.s,{direction:"column",alignItems:"stretch",gap:6,children:[(0,e.jsxs)(m.s,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsx)(h.o,{variant:"delta",as:"h2",children:a({id:(0,J.A)("Plugins.header.title"),defaultMessage:"Permissions"})}),(0,e.jsx)(h.o,{as:"p",textColor:"neutral600",children:a({id:(0,J.A)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."})})]}),(0,e.jsx)(Ie,{})]})}),(0,e.jsx)(ke,{})]})})});ge.propTypes={permissions:T().object.isRequired,routes:T().object.isRequired};const he=(0,r.memo)(ge);var ee=s(12083);const me=ee.Ik().shape({name:ee.Yj().required(n.iW.required),description:ee.Yj().required(n.iW.required)});var X=s(46215);const pe=()=>{const t=(0,n.hN)(),{get:o}=(0,n.ry)(),{formatAPIError:i}=(0,n.wq)(X.gT),[{data:a,isLoading:f,error:l,refetch:x},{data:y,isLoading:j,error:R,refetch:b}]=(0,D.useQueries)([{queryKey:["users-permissions","permissions"],async queryFn(){const{data:{permissions:S}}=await o("/users-permissions/permissions");return S}},{queryKey:["users-permissions","routes"],async queryFn(){const{data:{routes:S}}=await o("/users-permissions/routes");return S}}]),P=async()=>{await Promise.all([x(),b()])};(0,r.useEffect)(()=>{l&&t({type:"warning",message:i(l)})},[t,l,i]),(0,r.useEffect)(()=>{R&&t({type:"warning",message:i(R)})},[t,R,i]);const c=f||j;return{permissions:a?(0,X.mr)(a):{},routes:y??{},getData:P,isLoading:c}},ns=()=>{const{formatMessage:t}=(0,U.A)(),o=(0,n.hN)(),{goBack:i}=(0,d.W6)(),{lockApp:a,unlockApp:f}=(0,n.MA)(),{isLoading:l,permissions:x,routes:y}=pe(),{trackUsage:j}=(0,n.z1)(),R=r.useRef(),{post:b}=(0,n.ry)(),P=(0,D.useMutation)(S=>b("/users-permissions/roles",S),{onError(){o({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})},onSuccess(){j("didCreateRole"),o({type:"success",message:{id:(0,J.A)("Settings.roles.created"),defaultMessage:"Role created"}}),i()}}),c=async S=>{a();const B=R.current.getPermissions();await P.mutate({...S,...B,users:[]}),f()};return(0,e.jsxs)(p.g,{children:[(0,e.jsx)(n.x7,{name:"Roles"}),(0,e.jsx)($.l1,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:c,validationSchema:me,children:({handleSubmit:S,values:B,handleChange:Q,errors:O})=>(0,e.jsxs)(n.lV,{noValidate:!0,onSubmit:S,children:[(0,e.jsx)(g.Q,{primaryAction:!l&&(0,e.jsx)(v.$,{type:"submit",loading:P.isLoading,startIcon:(0,e.jsx)(L.A,{}),children:t({id:"global.save",defaultMessage:"Save"})}),title:t({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:t({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),(0,e.jsx)(M.s,{children:(0,e.jsxs)(m.s,{background:"neutral0",direction:"column",alignItems:"stretch",gap:7,hasRadius:!0,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,shadow:"filterShadow",children:[(0,e.jsxs)(m.s,{direction:"column",alignItems:"stretch",children:[(0,e.jsx)(h.o,{variant:"delta",as:"h2",children:t({id:(0,J.A)("EditPage.form.roles"),defaultMessage:"Role details"})}),(0,e.jsxs)(A.x,{gap:4,children:[(0,e.jsx)(N.E,{col:6,children:(0,e.jsx)(G.k,{name:"name",value:B.name||"",onChange:Q,label:t({id:"global.name",defaultMessage:"Name"}),error:O?.name?t({id:O.name,defaultMessage:"Name is required"}):!1,required:!0})}),(0,e.jsx)(N.E,{col:6,children:(0,e.jsx)(I.T,{id:"description",value:B.description||"",onChange:Q,label:t({id:"global.description",defaultMessage:"Description"}),error:O?.description?t({id:O.description,defaultMessage:"Description is required"}):!1,required:!0})})]})]}),!l&&(0,e.jsx)(he,{ref:R,permissions:x,routes:y})]})})]})})]})},os=()=>(0,e.jsx)(n.kz,{permissions:u.J.createRole,children:(0,e.jsx)(ns,{})});var rs=s(95065);const is=()=>{const{formatMessage:t}=(0,U.A)(),o=(0,n.hN)(),{lockApp:i,unlockApp:a}=(0,n.MA)(),{params:{id:f}}=(0,d.W5)("/settings/users-permissions/roles/:id"),{get:l}=(0,n.ry)(),{isLoading:x,routes:y}=pe(),{data:j,isLoading:R,refetch:b}=(0,D.useQuery)(["users-permissions","role",f],async()=>{const{data:{role:O}}=await l(`/users-permissions/roles/${f}`);return O}),P=r.useRef(),{put:c}=(0,n.ry)(),{formatAPIError:S}=(0,n.wq)(),B=(0,D.useMutation)(O=>c(`/users-permissions/roles/${f}`,O),{onError(O){o({type:"warning",message:S(O)})},async onSuccess(){o({type:"success",message:{id:(0,J.A)("Settings.roles.created"),defaultMessage:"Role edited"}}),await b()}}),Q=async O=>{i();const H=P.current.getPermissions();await B.mutate({...O,...H,users:[]}),a()};return R?(0,e.jsx)(n.Bl,{}):(0,e.jsxs)(p.g,{children:[(0,e.jsx)(n.x7,{name:"Roles"}),(0,e.jsx)($.l1,{enableReinitialize:!0,initialValues:{name:j.name,description:j.description},onSubmit:Q,validationSchema:me,children:({handleSubmit:O,values:H,handleChange:k,errors:Y})=>(0,e.jsxs)(n.lV,{noValidate:!0,onSubmit:O,children:[(0,e.jsx)(g.Q,{primaryAction:!x&&(0,e.jsx)(v.$,{disabled:j.code==="strapi-super-admin",type:"submit",loading:B.isLoading,startIcon:(0,e.jsx)(L.A,{}),children:t({id:"global.save",defaultMessage:"Save"})}),title:j.name,subtitle:j.description,navigationAction:(0,e.jsx)(n.N_,{startIcon:(0,e.jsx)(rs.A,{}),to:"/settings/users-permissions/roles",children:t({id:"global.back",defaultMessage:"Back"})})}),(0,e.jsx)(M.s,{children:(0,e.jsxs)(m.s,{background:"neutral0",direction:"column",alignItems:"stretch",gap:7,hasRadius:!0,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,shadow:"filterShadow",children:[(0,e.jsxs)(m.s,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(h.o,{variant:"delta",as:"h2",children:t({id:(0,J.A)("EditPage.form.roles"),defaultMessage:"Role details"})}),(0,e.jsxs)(A.x,{gap:4,children:[(0,e.jsx)(N.E,{col:6,children:(0,e.jsx)(G.k,{name:"name",value:H.name||"",onChange:k,label:t({id:"global.name",defaultMessage:"Name"}),error:Y?.name?t({id:Y.name,defaultMessage:"Name is required"}):!1,required:!0})}),(0,e.jsx)(N.E,{col:6,children:(0,e.jsx)(I.T,{id:"description",value:H.description||"",onChange:k,label:t({id:"global.description",defaultMessage:"Description"}),error:Y?.description?t({id:Y.description,defaultMessage:"Description is required"}):!1,required:!0})})]})]}),!x&&(0,e.jsx)(he,{ref:P,permissions:j.permissions,routes:y})]})})]})})]})},as=()=>(0,e.jsx)(n.kz,{permissions:u.J.updateRole,children:(0,e.jsx)(is,{})});var ls=s(70230),ds=s(53432),cs=s(44494),us=s(79318),gs=s(70768),fe=s(34508),V=s(21270),hs=s(31127),ms=s(80980),ps=s(83314),fs=s(19106),xs=s(31708),js=s(39423);const ys=(0,K.Ay)(ms.N)`
  align-items: center;
  height: ${(0,n.a8)(32)};
  display: flex;
  justify-content: center;
  padding: ${({theme:t})=>`${t.spaces[2]}}`};
  width: ${(0,n.a8)(32)};

  svg {
    height: ${(0,n.a8)(12)};
    width: ${(0,n.a8)(12)};

    path {
      fill: ${({theme:t})=>t.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:t})=>t.colors.neutral800};
      }
    }
  }
`,se=({sortedRoles:t,canDelete:o,permissions:i,setRoleToDelete:a,onDelete:f})=>{const{formatMessage:l}=(0,U.A)(),{push:x}=(0,d.W6)(),[y,j]=f,R=c=>o&&!["public","authenticated"].includes(c.type),b=c=>{a(c),j(!y)},P=c=>{x(`/settings/users-permissions/roles/${c}`)};return(0,e.jsx)(ps.N,{children:t?.map(c=>(0,e.jsxs)(fe.Tr,{...(0,n.qM)({fn:()=>P(c.id)}),children:[(0,e.jsx)(V.Td,{width:"20%",children:(0,e.jsx)(h.o,{children:c.name})}),(0,e.jsx)(V.Td,{width:"50%",children:(0,e.jsx)(h.o,{children:c.description})}),(0,e.jsx)(V.Td,{width:"30%",children:(0,e.jsx)(h.o,{children:l({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {# user} one {# user} other {# users}}"},{number:c.nb_users})})}),(0,e.jsx)(V.Td,{children:(0,e.jsxs)(m.s,{justifyContent:"end",...n.dG,children:[(0,e.jsx)(n.d4,{permissions:i.updateRole,children:(0,e.jsx)(ys,{to:`/settings/users-permissions/roles/${c.id}`,"aria-label":l({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${c.name}`}),children:(0,e.jsx)(xs.A,{})})}),R(c)&&(0,e.jsx)(n.d4,{permissions:i.deleteRole,children:(0,e.jsx)(fs.K,{onClick:()=>b(c.id),noBorder:!0,icon:(0,e.jsx)(js.A,{}),label:l({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${c.name}`})})})]})})]},c.name))})},vs=se;se.defaultProps={canDelete:!1},se.propTypes={onDelete:T().array.isRequired,permissions:T().object.isRequired,setRoleToDelete:T().func.isRequired,sortedRoles:T().array.isRequired,canDelete:T().bool};const As=async(t,o)=>{try{const{get:i}=(0,n.GD)(),{data:a}=await i("/users-permissions/roles");return o("The roles have loaded successfully"),a}catch(i){throw t({type:"warning",message:{id:"notification.error"}}),new Error(i)}},Cs=async(t,o)=>{try{const{del:i}=(0,n.GD)();await i(`/users-permissions/roles/${t}`)}catch{o({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}},Rs=()=>{const{trackUsage:t}=(0,n.z1)(),{formatMessage:o,locale:i}=(0,U.A)(),a=(0,n.hN)(),{notifyStatus:f}=(0,ls.W)(),[{query:l}]=(0,n.sq)(),x=l?._q||"",[y,j]=(0,r.useState)(!1),[R,b]=(0,r.useState)(!1),[P,c]=(0,r.useState)();(0,n.L4)();const{isLoading:S,allowedActions:{canRead:B,canDelete:Q}}=(0,n.ec)({create:u.J.createRole,read:u.J.readRoles,update:u.J.updateRole,delete:u.J.deleteRole}),{isLoading:O,data:{roles:H},isFetching:k,refetch:Y}=(0,D.useQuery)("get-roles",()=>As(a,f),{initialData:{},enabled:B}),{includes:xe}=(0,n.U2)(i,{sensitivity:"base"}),je=(0,n.QM)(i,{sensitivity:"base"}),ye=O||k,Ts=()=>{j(!y)},Ps={roles:{id:(0,X.gT)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,X.gT)("Roles.empty.search"),defaultMessage:"No roles match the search."}},Es=o({id:"global.roles",defaultMessage:"Roles"}),Ss=(0,D.useMutation)(z=>Cs(z,a),{async onSuccess(){await Y()}}),Ls=async()=>{b(!0),await Ss.mutateAsync(P),j(!y),b(!1)},w=(H||[]).filter(z=>xe(z.name,x)||xe(z.description,x)).sort((z,ve)=>je.compare(z.name,ve.name)||je.compare(z.description,ve.description)),Ds=x&&!w.length?"search":"roles",Os=4,Bs=(H?.length||0)+1;return(0,e.jsxs)(ds.P,{children:[(0,e.jsx)(n.x7,{name:Es}),(0,e.jsxs)(p.g,{"aria-busy":ye,children:[(0,e.jsx)(g.Q,{title:o({id:"global.roles",defaultMessage:"Roles"}),subtitle:o({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:(0,e.jsx)(n.d4,{permissions:u.J.createRole,children:(0,e.jsx)(n.z9,{to:"/settings/users-permissions/roles/new",onClick:()=>t("willCreateRole"),startIcon:(0,e.jsx)(hs.A,{}),size:"S",children:o({id:(0,X.gT)("List.button.roles"),defaultMessage:"Add new role"})})})}),(0,e.jsx)(cs.B,{startActions:(0,e.jsx)(n.q7,{label:o({id:"app.component.search.label",defaultMessage:"Search"})})}),(0,e.jsxs)(M.s,{children:[!B&&(0,e.jsx)(n.UW,{}),(ye||S)&&(0,e.jsx)(n.Bl,{}),B&&w&&w?.length?(0,e.jsxs)(us.X,{colCount:Os,rowCount:Bs,children:[(0,e.jsx)(gs.d,{children:(0,e.jsxs)(fe.Tr,{children:[(0,e.jsx)(V.Th,{children:(0,e.jsx)(h.o,{variant:"sigma",textColor:"neutral600",children:o({id:"global.name",defaultMessage:"Name"})})}),(0,e.jsx)(V.Th,{children:(0,e.jsx)(h.o,{variant:"sigma",textColor:"neutral600",children:o({id:"global.description",defaultMessage:"Description"})})}),(0,e.jsx)(V.Th,{children:(0,e.jsx)(h.o,{variant:"sigma",textColor:"neutral600",children:o({id:"global.users",defaultMessage:"Users"})})}),(0,e.jsx)(V.Th,{children:(0,e.jsx)(ie.s,{children:o({id:"global.actions",defaultMessage:"Actions"})})})]})}),(0,e.jsx)(vs,{sortedRoles:w,canDelete:Q,permissions:u.J,setRoleToDelete:c,onDelete:[y,j]})]}):(0,e.jsx)(n.pA,{content:Ps[Ds]})]}),(0,e.jsx)(n.TM,{isConfirmButtonLoading:R,onConfirm:Ls,onToggleDialog:Ts,isOpen:y})]})]})},Ms=()=>(0,e.jsx)(n.kz,{permissions:u.J.accessRoles,children:(0,e.jsx)(Rs,{})}),bs=()=>(0,e.jsx)(n.kz,{permissions:u.J.accessRoles,children:(0,e.jsxs)(d.dO,{children:[(0,e.jsx)(d.qh,{path:"/settings/users-permissions/roles/new",component:os,exact:!0}),(0,e.jsx)(d.qh,{path:"/settings/users-permissions/roles/:id",component:as,exact:!0}),(0,e.jsx)(d.qh,{path:"/settings/users-permissions/roles",component:Ms,exact:!0}),(0,e.jsx)(d.qh,{path:"",component:n.hH})]})})},46215:(C,E,s)=>{"use strict";s.d(E,{mr:()=>d,gT:()=>u.A});var e=s(77965),r=s.n(e);const d=p=>Object.keys(p).reduce((g,v)=>{const M=p[v].controllers,m=Object.keys(M).reduce((h,A)=>(r()(M[A])||(h[A]=M[A]),h),{});return r()(m)||(g[v]={controllers:m}),g},{});var u=s(34075)},60759:(C,E,s)=>{var e=s(48143),r=s(83289),n=s(96685),d=s(87864),u=s(52689),p=s(37879),g=200;function v(M,m,h,A){var N=-1,G=r,I=!0,L=M.length,$=[],U=m.length;if(!L)return $;h&&(m=d(m,u(h))),A?(G=n,I=!1):m.length>=g&&(G=p,I=!1,m=new e(m));e:for(;++N<L;){var D=M[N],W=h==null?D:h(D);if(D=A||D!==0?D:0,I&&W===W){for(var T=U;T--;)if(m[T]===W)continue e;$.push(D)}else G(m,W,A)||$.push(D)}return $}C.exports=v},97449:(C,E,s)=>{var e=s(85373),r=s(75821),n=r(e);C.exports=n},29884:(C,E,s)=>{var e=s(97449),r=s(91522);function n(d,u){var p=-1,g=r(d)?Array(d.length):[];return e(d,function(v,M,m){g[++p]=u(v,M,m)}),g}C.exports=n},4191:(C,E,s)=>{var e=s(87864),r=s(86386),n=s(45353),d=s(29884),u=s(74565),p=s(52689),g=s(48126),v=s(82388),M=s(82261);function m(h,A,N){A.length?A=e(A,function(L){return M(L)?function($){return r($,L.length===1?L[0]:L)}:L}):A=[v];var G=-1;A=e(A,p(n));var I=d(h,function(L,$,U){var D=e(A,function(W){return W(L)});return{criteria:D,index:++G,value:L}});return u(I,function(L,$){return g(L,$,N)})}C.exports=m},74565:C=>{function E(s,e){var r=s.length;for(s.sort(e);r--;)s[r]=s[r].value;return s}C.exports=E},64958:(C,E,s)=>{var e=s(91662);function r(n,d){if(n!==d){var u=n!==void 0,p=n===null,g=n===n,v=e(n),M=d!==void 0,m=d===null,h=d===d,A=e(d);if(!m&&!A&&!v&&n>d||v&&M&&h&&!m&&!A||p&&M&&h||!u&&h||!g)return 1;if(!p&&!v&&!A&&n<d||A&&u&&g&&!p&&!v||m&&u&&g||!M&&g||!h)return-1}return 0}C.exports=r},48126:(C,E,s)=>{var e=s(64958);function r(n,d,u){for(var p=-1,g=n.criteria,v=d.criteria,M=g.length,m=u.length;++p<M;){var h=e(g[p],v[p]);if(h){if(p>=m)return h;var A=u[p];return h*(A=="desc"?-1:1)}}return n.index-d.index}C.exports=r},75821:(C,E,s)=>{var e=s(91522);function r(n,d){return function(u,p){if(u==null)return u;if(!e(u))return n(u,p);for(var g=u.length,v=d?g:-1,M=Object(u);(d?v--:++v<g)&&p(M[v],v,M)!==!1;);return u}}C.exports=r},34542:(C,E,s)=>{var e=s(87864),r=s(45353),n=s(29884),d=s(82261);function u(p,g){var v=d(p)?e:n;return v(p,r(g,3))}C.exports=u},45635:(C,E,s)=>{var e=s(87212),r=s(4191),n=s(39226),d=s(3956),u=n(function(p,g){if(p==null)return[];var v=g.length;return v>1&&d(p,g[0],g[1])?g=[]:v>2&&d(g[0],g[1],g[2])&&(g=[g[0]]),r(p,e(g,1),[])});C.exports=u},61468:(C,E,s)=>{var e=s(52196);function r(n){var d=n==null?0:n.length;return d?e(n,1,d):[]}C.exports=r},28604:(C,E,s)=>{var e=s(60759),r=s(39226),n=s(56793),d=r(function(u,p){return n(u)?e(u,p):[]});C.exports=d}}]);
