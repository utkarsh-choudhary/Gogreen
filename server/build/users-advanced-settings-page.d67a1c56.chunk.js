"use strict";(self.webpackChunkserver=self.webpackChunkserver||[]).push([[8754],{1382:(N,u,e)=>{e.r(u),e.d(u,{default:()=>D});var t=e(92132),y=e(21272),M=e(70230),f=e(55794),h=e(43121),l=e(32559),r=e(69564),p=e(44370),c=e(43242),v=e(57842),g=e(57564),d=e(68065),P=e(45024),R=e(89787),a=e(39747),I=e(13333),O=e(61535),H=e(54894),x=e(74930),E=e(69224),s=e(46215);const Q=[{intlLabel:{id:(0,s.gT)("EditForm.inputToggle.label.email"),defaultMessage:"One account per email address"},description:{id:(0,s.gT)("EditForm.inputToggle.description.email"),defaultMessage:"Disallow the user to create multiple accounts using the same email address with different authentication providers."},name:"unique_email",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,s.gT)("EditForm.inputToggle.label.sign-up"),defaultMessage:"Enable sign-ups"},description:{id:(0,s.gT)("EditForm.inputToggle.description.sign-up"),defaultMessage:"When disabled (OFF), the registration process is forbidden. No one can subscribe anymore no matter the used provider."},name:"allow_register",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,s.gT)("EditForm.inputToggle.label.email-reset-password"),defaultMessage:"Reset password page"},description:{id:(0,s.gT)("EditForm.inputToggle.description.email-reset-password"),defaultMessage:"URL of your application's reset password page."},placeholder:{id:(0,s.gT)("EditForm.inputToggle.placeholder.email-reset-password"),defaultMessage:"ex: https://youtfrontend.com/reset-password"},name:"email_reset_password",type:"text",size:{col:6,xs:12}},{intlLabel:{id:(0,s.gT)("EditForm.inputToggle.label.email-confirmation"),defaultMessage:"Enable email confirmation"},description:{id:(0,s.gT)("EditForm.inputToggle.description.email-confirmation"),defaultMessage:"When enabled (ON), new registered users receive a confirmation email."},name:"email_confirmation",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,s.gT)("EditForm.inputToggle.label.email-confirmation-redirection"),defaultMessage:"Redirection url"},description:{id:(0,s.gT)("EditForm.inputToggle.description.email-confirmation-redirection"),defaultMessage:"After you confirmed your email, choose where you will be redirected."},placeholder:{id:(0,s.gT)("EditForm.inputToggle.placeholder.email-confirmation-redirection"),defaultMessage:"ex: https://youtfrontend.com/email-confirmation"},name:"email_confirmation_redirection",type:"text",size:{col:6,xs:12}}];var m=e(12083);const A=new RegExp("(^$)|((.+:\\/\\/.*)(d*)\\/?(.*))"),W=m.Ik().shape({email_confirmation_redirection:m.gl().when("email_confirmation",{is:!0,then:m.Yj().matches(A).required(),otherwise:m.Yj().nullable()}),email_reset_password:m.Yj(a.iW.string).matches(A,a.iW.regex).nullable()}),w=()=>(0,t.jsx)(a.kz,{permissions:E.J.readAdvancedSettings,children:(0,t.jsx)(B,{})}),B=()=>{const{formatMessage:o}=(0,H.A)(),T=(0,a.hN)(),{lockApp:G,unlockApp:F}=(0,a.MA)(),{notifyStatus:U}=(0,M.W)(),Y=(0,x.useQueryClient)(),{get:J,put:V}=(0,a.ry)(),{formatAPIError:$}=(0,a.wq)();(0,a.L4)();const{isLoading:X,allowedActions:{canUpdate:b}}=(0,a.ec)({update:E.J.updateAdvancedSettings}),{isLoading:K,data:L}=(0,x.useQuery)(["users-permissions","advanced"],async()=>{const{data:n}=await J("/users-permissions/advanced");return n},{onSuccess(){U(o({id:(0,s.gT)("Form.advancedSettings.data.loaded"),defaultMessage:"Advanced settings data has been loaded"}))},onError(){T({type:"warning",message:{id:(0,s.gT)("notification.error"),defaultMessage:"An error occured"}})}}),Z=X||K,z=(0,x.useMutation)(n=>V("/users-permissions/advanced",n),{async onSuccess(){await Y.invalidateQueries(["users-permissions","advanced"]),T({type:"success",message:{id:(0,s.gT)("notification.success.saved"),defaultMessage:"Saved"}}),F()},onError(n){T({type:"warning",message:$(n)}),F()},refetchActive:!0}),{isLoading:k}=z,q=async n=>{G(),z.mutate({...n,email_confirmation_redirection:n.email_confirmation?n.email_confirmation_redirection:""})};return Z?(0,t.jsxs)(f.g,{"aria-busy":"true",children:[(0,t.jsx)(a.x7,{name:o({id:(0,s.gT)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),(0,t.jsx)(h.Q,{title:o({id:(0,s.gT)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),(0,t.jsx)(l.s,{children:(0,t.jsx)(a.Bl,{})})]}):(0,t.jsxs)(f.g,{"aria-busy":k,children:[(0,t.jsx)(a.x7,{name:o({id:(0,s.gT)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),(0,t.jsx)(O.l1,{onSubmit:q,initialValues:L.settings,validateOnChange:!1,validationSchema:W,enableReinitialize:!0,children:({errors:n,values:j,handleChange:C,isSubmitting:_,dirty:ee})=>(0,t.jsxs)(a.lV,{children:[(0,t.jsx)(h.Q,{title:o({id:(0,s.gT)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"}),primaryAction:(0,t.jsx)(r.$,{loading:_,type:"submit",disabled:b?!ee:!b,startIcon:(0,t.jsx)(I.A,{}),size:"S",children:o({id:"global.save",defaultMessage:"Save"})})}),(0,t.jsx)(l.s,{children:(0,t.jsx)(p.a,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,t.jsxs)(c.s,{direction:"column",alignItems:"stretch",gap:4,children:[(0,t.jsx)(v.o,{variant:"delta",as:"h2",children:o({id:"global.settings",defaultMessage:"Settings"})}),(0,t.jsxs)(g.x,{gap:6,children:[(0,t.jsx)(d.E,{col:6,s:12,children:(0,t.jsx)(P.l,{label:o({id:(0,s.gT)("EditForm.inputSelect.label.role"),defaultMessage:"Default role for authenticated users"}),value:j.default_role,hint:o({id:(0,s.gT)("EditForm.inputSelect.description.role"),defaultMessage:"It will attach the new authenticated user to the selected role."}),onChange:i=>C({target:{name:"default_role",value:i}}),children:L.roles.map(i=>(0,t.jsx)(R.c,{value:i.type,children:i.name},i.type))})}),Q.map(i=>{let S=j[i.name];return S||(S=i.type==="bool"?!1:""),(0,t.jsx)(d.E,{...i.size,children:(0,t.jsx)(a.ah,{...i,value:S,error:n[i.name],disabled:i.name==="email_confirmation_redirection"&&j.email_confirmation===!1,onChange:C})},i.name)})]})]})})})]})})]})},D=w},46215:(N,u,e)=>{e.d(u,{mr:()=>f,gT:()=>h.A});var t=e(77965),y=e.n(t);const f=l=>Object.keys(l).reduce((r,p)=>{const c=l[p].controllers,v=Object.keys(c).reduce((g,d)=>(y()(c[d])||(g[d]=c[d]),g),{});return y()(v)||(r[p]={controllers:v}),r},{});var h=e(34075)}}]);
